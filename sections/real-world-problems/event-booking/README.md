# Design a Highly Concurrent Event Booking System

‡¶è‡¶ï‡¶ü‡¶ø ‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü, ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶ï ‡¶∏‡¶ø‡¶ü ‡¶•‡¶æ‡¶ï‡ßá ‡¶è‡¶¨‡¶Ç ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßá‡•§ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø Highly Concurrent Event Booking System ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶æ, ‡¶Ø‡¶æ ‡¶è‡¶ï‡¶á ‡¶∏‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶§‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶ï ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü (‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£‡¶∏‡ßç‡¶¨‡¶∞‡ßÇ‡¶™: ‡ß´‡ß¶‡ß¶+ concurrent requests per seat) ‡¶∏‡¶æ‡¶Æ‡¶≤‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§

## Key requirements

**Concurrency Handling**:

- ‡¶è‡¶ï‡¶á ‡¶∏‡¶Æ‡ßü‡ßá ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶ø‡¶ü ‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá‡•§

- ‡¶∞‡ßá‡¶∏ ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶® (Race Condition) ‡¶¨‡¶æ ‡¶ì‡¶≠‡¶æ‡¶∞‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶Ø‡ßá‡¶® ‡¶®‡¶æ ‡¶π‡ßü, ‡¶§‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

**Atomic Seat Booking**:

- ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ‡¶ü‡¶ø ‡¶è‡¶Æ‡¶®‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡ßá ‡¶ï‡ßá‡¶¨‡¶≤ ‡¶è‡¶ï‡¶ú‡¶®‡¶á ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡•§

- ‡¶∏‡¶ø‡¶ü ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶π‡¶¨‡ßá "first-come, first-served" ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶§‡ßá, transaction ‡¶Ø‡ßá‡¶® atomic ‡¶π‡ßü‡•§

**Failure Handling & Retry Mechanism**:

- ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡ßá‡¶á‡¶≤ ‡¶π‡¶ì‡ßü‡¶æ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá, ‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

## ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ï‡¶ø ‡¶∂‡¶ø‡¶ñ‡¶¨‡ßã?

**Concurrency Management**

- ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞‡ßã ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡ßü

- ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶ï ‡¶∏‡¶ø‡¶ü‡¶ï‡ßá ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ï‡¶®‡¶´‡ßç‡¶≤‡¶ø‡¶ï‡ßç‡¶ü ‡¶è‡ßú‡¶æ‡¶§‡ßá ‡¶π‡ßü

**Atomic Transactions**

- Atomicity ‡¶ï‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßá‡¶® ‡¶è‡¶ü‡¶æ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£

- SQL ‡¶¨‡¶æ NoSQL ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá atomic ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶®‡¶æ‡¶§‡ßá ‡¶π‡ßü

**Stripe Payment**

- ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü?

**Error Handling & Retry Logic**

- Request fail ‡¶π‡¶≤‡ßá ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá retry ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá

- Idempotency ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá implement ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡ßü

## ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®

‡¶ß‡¶∞‡ßá ‡¶®‡¶ø, ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ MySQL‡•§ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞‡ßã ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶ø‡¶ü ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶∏‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§

<p align="center">
  <img src="./images/concurrency-1.png" alt="concurrency">
</p>

‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ú‡¶æ‡¶®‡¶ø, MySQL ‡¶®‡¶ø‡¶ú‡ßá ACID ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá‡•§

Concurrency ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞‡¶ï‡ßá Exclusive Locking(Pessimistic Locking) mechanism ‡¶¨‡ßÅ‡¶ú‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

Exclusive Lock ‡¶π‡¶≤‡ßã ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≤‡¶ï ‡¶Ø‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø row ‡¶è‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶ï‡ßá‡¶¨‡¶≤ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶®‡¶ï‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ control ‡¶¶‡ßá‡¶Ø‡¶º‡•§ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ,

```sql
START TRANSACTION;

SELECT * FROM seats WHERE seat_id = 123 AND status = 'available' FOR UPDATE;

UPDATE seats SET status = 'booked', user_id = 456 WHERE seat_id = 123; COMMIT;
```

‡¶è‡¶ñ‡¶æ‡¶®‡ßá FOR UPDATE; Exclusive Lock/Pessimistic Lock ‡¶§‡ßà‡¶∞‡ßÄ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡•§ ‡¶Ø‡¶æ‡¶∞ ‡¶´‡¶≤‡ßá ‡¶è‡¶ñ‡¶® ‡¶∏‡ßá‡¶á ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü row ‡¶§‡ßá Exclusive Lock ‡¶•‡¶æ‡¶ï‡¶æ‡¶ï‡¶æ‡¶≤‡ßÄ‡¶®, ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã Transaction ‡¶∏‡ßá‡¶á row ‡¶ü‡¶ø‡¶ï‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§

‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶ê row-‡¶ü‡¶æ‡¶ï‡ßá update/delete ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá, ‡¶∏‡ßá‡¶ü‡¶æ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶Ø‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶®‡¶æ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® commit/rollback ‡¶π‡¶Ø‡¶º‡•§

‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé ‡¶è‡¶ï ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá ‡¶è‡¶ï‡¶ü‡¶ø‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡ßá‡¶á row ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§ ‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡ßá‡¶∏ ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶® (Race Condition) ‡¶¨‡¶æ ‡¶ì‡¶≠‡¶æ‡¶∞‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§

**‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü?**

‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶®‡¶æ ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡ßü ‡¶®‡¶æ‡•§ ‡¶è‡¶ñ‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ø‡¶æ ‡¶∂‡¶ø‡¶ñ‡¶≤‡¶æ‡¶Æ,

## Phase 1

### ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø: seat temporarily reserve ‡¶ï‡¶∞‡¶æ, payment ‡¶è‡¶∞ ‡¶Ü‡¶ó‡ßá

- User ‡¶∏‡¶ø‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá

- Transaction ‡¶∂‡ßÅ‡¶∞‡ßÅ

- Lock row

‡¶Ø‡¶ñ‡¶® ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡¶∂‡¶® ‡¶è‡¶∞ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶¨, ‡¶§‡¶ñ‡¶® ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶®‡¶ø‡ßü‡ßá ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá,

Lock ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶ø‡¶ü‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü‡¶æ‡¶∏ ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 'HELD' ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶¨, ‡¶ê user ‡¶è‡¶∞ ID ‡¶¶‡¶ø‡ßü‡ßá‡•§ **‡¶è‡¶§‡ßá ‡¶ï‡¶∞‡ßá ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶π‡¶¨‡ßá, ‡¶è‡¶ü‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø "Time Window" ‡¶¶‡ßá‡ßü, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü‡¶≤‡¶ø ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§**

```js
import { PrismaClient } from '@prisma/client'
const prisma = new PrismaClient()

async function holdSeat(seatId: number, userId: number) {
  try {
    return await prisma.$transaction(async (tx) => {
      // üîí ‡ßß. ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø SQL ‡¶ï‡ßÅ‡ßü‡ßá‡¶∞‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü Row-‡¶ü‡¶ø ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ
      const seats = await tx.$queryRaw<any[]>`
        SELECT status, hold_expires_at
        FROM seats
        WHERE seat_id = ${seatId}
        FOR UPDATE
      `;

      if (seats.length === 0) throw new Error("Seat not found");

      const seat = seats[0];
      const now = new Date();

      // ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶Ü‡¶¶‡ßá‡¶ì ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶®‡¶æ‡¶ï‡¶ø ‡¶ï‡¶æ‡¶∞‡ßã ‡¶π‡ßã‡¶≤‡ßç‡¶° ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá‡¶õ‡ßá?
      const isAvailable =
        seat.status === 'AVAILABLE' ||
        (seat.status === 'HELD' && seat.hold_expires_at && new Date(seat.hold_expires_at) < now);

      if (!isAvailable) {
        throw new Error("Seat already taken or held by someone else");
      }

      // ‚úèÔ∏è ‡ß®. ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡¶ø‡¶ú‡¶æ‡¶∞‡ßç‡¶≠ ‡¶ï‡¶∞‡¶æ
      await tx.$executeRaw`
        UPDATE seats
        SET status = 'HELD',
            held_by_user = ${userId},
            hold_expires_at = NOW() + INTERVAL 10 MINUTE
        WHERE seat_id = ${seatId}
      `;

      return { success: true, message: "Seat held for 10 minutes" };
    });
  } catch (error) {
    return { success: false, error: error.message };
  }
}
```

## Phase 2 (Payment & Final Booking)

‡¶Ø‡¶ñ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶á‡¶™ (Stripe) ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶Ü‡¶∏‡ßá, ‡¶§‡¶ñ‡¶® ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡ßü ‡¶Ø‡ßá ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶∏‡ßá‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡¶á 'HELD' ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶Ü‡¶õ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ø‡ßá‡¶® ‡¶∏‡ßá‡¶ü‡¶ø ‡¶™‡¶æ‡¶∞‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü‡¶≤‡¶ø 'BOOKED' ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü‡•§

```js
async function finalizeBooking(seatId: number, userId: number, paymentId: string) {
  return await prisma.$transaction(async (tx) => {
    // ‡ßß. ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡¶á 'HELD' ‡¶Ü‡¶õ‡ßá
    const seats = await tx.$queryRaw<any[]>`
      SELECT * FROM seats
      WHERE seat_id = ${seatId}
      AND status = 'HELD'
      AND held_by_user = ${userId}
      AND hold_expires_at > NOW()
      FOR UPDATE
    `;

    if (seats.length === 0) {
      // ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
      throw new Error("Reservation expired or invalid. Please try again.");
    }

    // ‡ß®. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (Idempotency ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá)
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá paymentId ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶á ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßÅ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶®‡¶æ ‡¶π‡ßü
    await tx.payment.create({
      data: {
        paymentId: paymentId,
        userId: userId,
        seatId: seatId,
        status: 'COMPLETED'
      }
    });

    // ‡ß©. ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá 'BOOKED' ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
    await tx.seats.update({
      where: { seat_id: seatId },
      data: {
        status: 'BOOKED',
        held_by_user: null, // ‡¶π‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡¶ø‡¶≤‡¶ø‡¶ú ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
        hold_expires_at: null
      }
    });

    return { success: true, message: "Seat booked successfully!" };
  });
}
```

‡¶Ø‡¶¶‡¶ø ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü, stripe ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø WebHook ‡¶¶‡¶ø‡¶¨‡ßá‡•§ ‡¶è‡¶á WebHook ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ï‡¶®‡ßç‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßã ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ WebHook ‡¶Ü‡¶∏‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá finalizeBooking function ‡¶∞‡¶æ‡¶® ‡¶π‡¶¨‡ßá‡•§

**‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶ú‡ßá ‡¶•‡¶æ‡¶ï‡¶æ‡¶ï‡¶æ‡¶≤‡ßÄ‡¶® ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶Ø‡¶¶‡¶ø ‡¶†‡¶ø‡¶ï ‡ßØ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡ß´‡ßØ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶π‡ßü, ‡¶Ü‡¶∞ ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡ß¶‡ßß ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ WebHook ‡¶ü‡¶ø ‡¶™‡¶æ‡ßü, ‡¶§‡¶¨‡ßá ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶∞‡¶ø‡¶≤‡¶ø‡¶ú ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ‡•§** ‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé,

```js
const seats = await tx.$queryRaw<any[]>`
  SELECT * FROM seats
  WHERE seat_id = ${seatId}
  AND status = 'HELD'
  AND held_by_user = ${userId}
  AND hold_expires_at > NOW()
  FOR UPDATE
`;
```

empty ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶ï‡¶∞‡¶¨‡ßá‡•§ ‡¶∏‡ßá‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡¶æ‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

**‡¶Ø‡¶¶‡¶ø ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü ‡¶è‡¶¨‡¶Ç ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá, ‡¶§‡¶ñ‡¶® ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü?**

‡¶Ø‡¶ñ‡¶® ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ê ‡¶è‡¶ï‡¶á ‡¶∏‡¶ø‡¶ü ‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶∏‡ßá, ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ï‡ßÅ‡ßü‡ßá‡¶∞‡¶ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ø‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶π‡ßã‡¶≤‡ßç‡¶° ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ‡•§

```js
import { PrismaClient } from '@prisma/client'
const prisma = new PrismaClient()

async function holdSeat(seatId: number, userId: number) {
  try {
    return await prisma.$transaction(async (tx) => {
      // ‡ßß. SQL-‡¶è‡¶á ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶õ‡¶ø ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø AVAILABLE ‡¶ï‡¶ø ‡¶®‡¶æ ‡¶Ö‡¶•‡¶¨‡¶æ HOLD ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶ø ‡¶®‡¶æ
      // ‡¶Ø‡¶¶‡¶ø ‡¶∂‡¶∞‡ßç‡¶§ ‡¶®‡¶æ ‡¶Æ‡¶ø‡¶≤‡ßá, ‡¶§‡¶¨‡ßá ‡¶ï‡ßã‡¶®‡ßã Row ‡¶≤‡¶ï ‡¶π‡¶¨‡ßá ‡¶®‡¶æ (Empty Result)
      const seats = await tx.$queryRaw<any[]>`
        SELECT seat_id, status
        FROM seats
        WHERE seat_id = ${seatId}
          AND (status = 'AVAILABLE' OR hold_expires_at < NOW())
        FOR UPDATE
      `;

      // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßá‡¶â ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡ßã‡¶≤‡ßç‡¶° ‡¶ï‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá Array ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶Ü‡¶∏‡¶¨‡ßá
      if (seats.length === 0) {
        throw new Error("Seat is currently unavailable or already held by an active user");
      }

      // ‚úèÔ∏è ‡ß®. ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡•§ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá Date ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§
      await tx.$executeRaw`
        UPDATE seats
        SET status = 'HELD',
          held_by_user = ${userId},
          hold_expires_at = NOW() + INTERVAL 10 MINUTE
        WHERE seat_id = ${seatId}
      `;

      return { success: true, message: "Seat successfully held for 10 minutes" };
    });
  } catch (error: any) {
    return { success: false, error: error.message };
  }
}
```

‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡¶¶‡¶ø ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü, ‡¶§‡¶¨‡ßá hold_expires_at < NOW() ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶®‡¶ü‡¶ø True ‡¶π‡¶¨‡ßá‡•§ ‡¶´‡¶≤‡ßá ‡¶®‡¶§‡ßÅ‡¶® user ‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶ó‡ßá‡¶∞ user ‡¶è‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ overwrite ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶¨‡ßá‡•§

**Concurrency ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶ß‡ßÅ SQL FOR UPDATE ‡¶¶‡¶ø‡¶≤‡ßá‡¶á ‡¶∂‡ßá‡¶∑ ‡¶®‡ßü ‚Äî Connection Pool ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶¨‡ßá‡•§**

### ‡¶ï‡ßá‡¶® Connection Pool ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞?

- ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá, ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡ßá‡¶ï ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶§‡ßÅ‡¶® DB ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® open ‡¶ï‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá, MySQL ‡¶§‡¶æ‡ßú‡¶æ‡¶§‡¶æ‡ßú‡¶ø overheat ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§

- Connection Pool ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶ó‡ßá‡¶≠‡¶æ‡¶ó‡ßá‡¶á ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶∞‡¶æ‡¶ñ‡ßá, ‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶® reuse ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§

MySQL ‡¶è innodb_lock_wait_timeout (‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü 50s) ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ø‡¶¶‡¶ø lock release ‡¶®‡¶æ ‡¶π‡ßü, transaction error ‡¶¶‡ßá‡¶¨‡ßá,

```
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
```

‡¶§‡¶æ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶π‡¶ú ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶∞‡ßá ‡¶®‡¶ø‡¶≤‡¶æ‡¶Æ, Deadlock ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡¶®‡¶æ ‡¶®‡¶æ‡¶á‡•§

**Deadlock ‡¶Æ‡ßÇ‡¶≤‡¶§ ‡¶§‡¶ñ‡¶®‡¶á ‡¶π‡ßü ‡¶Ø‡¶ñ‡¶® ‡¶è‡¶ï‡¶á Transaction ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï row ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ï ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶®‡ßç‡¶Ø Transaction ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶â‡¶≤‡ßç‡¶ü‡ßã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá ‡¶≤‡¶ï ‡¶ï‡¶∞‡ßá‡•§**

‡¶è‡¶ñ‡¶® Atomic Seat Booking ‡¶®‡¶ø‡ßü‡ßá ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ï‡•§

‡¶â‡¶™‡¶∞‡ßá ‡¶Ø‡ßá‡¶π‡ßá‡¶§‡ßÅ ‡¶Ü‡¶Æ‡¶∞‡¶æ FOR UPDATE ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø ‡¶∏‡ßá‡¶π‡ßá‡¶§‡ßÅ,

- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶¨‡ßá‡•§
- ‡¶¨‡¶æ‡¶ï‡¶ø‡¶∞‡¶æ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá (lock release ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá)‡•§
- ‡¶´‡¶≤‡ßá first-come, first-served ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶§‡ßá ‡¶∏‡¶ø‡¶ü ‡¶¨‡ßÅ‡¶ï ‡¶π‡¶¨‡ßá‡•§

‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ Atomic Seat Booking ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡ßã‡•§

‡ß©‡ßü ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßã, Failure Handling ‡¶è‡¶¨‡¶Ç Retry Mechanism

failure ‡¶è‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶è‡¶∞‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá,

- Transaction ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ó‡¶ø‡¶Ø‡¶º‡ßá timeout ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü‡•§

- DB connection drop, network latency, or pool exhaustion

### ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá retry ‡¶ï‡¶∞‡¶¨‡ßã?

- ‡¶∏‡¶ø‡¶ü ‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá Transaction ‡¶¶‡¶ø‡ßü‡ßá‡•§

- ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡ßá ‡¶®‡¶æ ‡¶π‡¶≤‡ßá retry function ‡¶≤‡¶ø‡¶ñ‡¶¨‡ßã (timeout ‡¶π‡¶≤‡ßá)‡•§

- ‡¶ï‡ßã‡¶°‡ßá idempotency ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§ ‡¶Æ‡¶æ‡¶®‡ßá ‡¶á‡¶§‡ßã‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶¨‡ßÅ‡¶ï ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ ‡¶§‡¶æ ‡¶¨‡ßÅ‡¶ú‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

- Retry ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ù‡ßá exponential backoff ‡¶¶‡¶ø‡ßü‡ßá DB-‡¶ï‡ßá ‡¶ö‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶æ‡¶¨‡ßá‡•§

- ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö retry-‡¶∞ ‡¶™‡¶∞‡¶ì fail ‡¶π‡¶≤‡ßá ‚Üí error ‡¶¶‡¶ø‡¶¨‡ßá‡•§

- ‡¶∏‡¶ø‡¶ü ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‚Üí ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá‡¶á fail ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶ï‡¶∞‡¶¨‡ßá‡•§

‡¶è‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡•§

‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶è‡¶ï‡¶ú‡¶® ‡¶∏‡¶´‡¶ü‡¶ì‡ßü‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶®‡¶ø‡ßü‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ü‡¶∏‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá,

**‡¶ï‡ßá‡¶®‡ßã Transaction? ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡ßã‡ßü‡ßá‡¶∞‡¶ø ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶ï‡¶ø?**

```sql
UPDATE seats
SET status = 'booked', user_id = 456
WHERE seat_id = 123 AND status = 'available';
```

- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã START TRANSACTION ‡¶®‡ßá‡¶á

- ‡¶ï‡ßã‡¶®‡ßã SELECT ... FOR UPDATE ‡¶®‡ßá‡¶á

‡¶§‡¶ñ‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ü‡¶æ ‡¶è‡¶∞‡¶ï‡¶Æ ‡¶π‡¶¨‡ßá,

- MySQL ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá row ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá, ‡¶Ø‡¶¶‡¶ø status = 'available' ‡¶•‡¶æ‡¶ï‡ßá‡•§

- ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï request ‡¶è‡¶≤‡ßá ‡¶∏‡¶¨‡¶æ‡¶á status ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§

- ‡¶§‡¶¨‡ßá UPDATE ‡¶®‡¶ø‡¶ú‡ßá row-level lock ‚Äî ‡¶§‡¶æ‡¶á ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø‡¶á update ‡¶π‡¶¨‡ßá‡•§

- ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ race condition ‡¶è‡ßú‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡ßü ‡¶®‡¶æ, ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ó‡ßá SELECT ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá‡¶®‡•§

‡¶è‡¶á Race Condition ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶Ü‡¶Æ‡¶∞‡¶æ Transaction + FOR UPDATE ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡•§
